(function(w,A){typeof exports=="object"&&typeof module<"u"?A(exports,require("react/jsx-runtime"),require("react")):typeof define=="function"&&define.amd?define(["exports","react/jsx-runtime","react"],A):(w=typeof globalThis<"u"?globalThis:w||self,A(w["@rvision/use-form"]={},w["react/jsx-runtime"],w.react))})(this,function(w,A,d){"use strict";const Z=e=>typeof e=="function",C={},h=()=>C;let le=2e9;const O=new WeakMap,pe=e=>{let r=O.get(e);return r||(r=(le++).toString(36),O.set(e,r)),r},P=e=>{let r;if(e instanceof Set)r=new Set([...e]);else{const o=Array.isArray(e);r=o?[...e]:{...e},o&&e.message&&(r.message=e.message,r.type=e.type)}return O.has(e)&&(O.set(r,O.get(e)),O.delete(e)),r},ye=/\[([^\]]+)\]/g;let J=new Map;const q=e=>{if(!e)return[];let r=J.get(e);return r||(r=e.replace(ye,".$1").split(".").map(o=>+o-+o<1?+o:o),J.set(e,r),r)},me=()=>{J=new Map},z=(e,r)=>{if(r!==void 0)return e.length===0?r:z(e.slice(1),r[e[0]])},E=(e,r)=>z(q(e),r),ee=(e,r,o)=>{const{length:c}=e;if(c===0)return;const u=e[0];if(c===1){r[u]=o;return}const l=r[u]!==void 0,y=e[1],S=+y-+y<1;r[u]=l?P(r[u]):S?[]:{},S&&(r[u][y]=r[u][y]===void 0?{}:P(r[u][y])),ee(e.slice(1),r[u],o)},v=(e,r,o)=>{const c={...r};return ee(q(e),c,o),c},B=(e,r)=>{const{length:o}=e;if(o===0||r===void 0)return;const c=e[0];if(o===1){delete r[c];return}B(e.slice(1),r[c])},H=e=>Object.keys(e||C).length===0,ge=(e,r)=>{B(e,r),e.map((c,u)=>u===0?[...e]:[...e].slice(0,-1*u)).forEach(c=>{const u=z(c,r);u!==void 0&&(Array.isArray(u)?(u.length===0||u.every(H))&&!u.message&&B(c,r):H(u)&&B(c,r))})},b=(e,r)=>{const o={...r};return ge(q(e),o),o},Ee=e=>{const{value:r,type:o,checked:c,options:u,files:l,multiple:y,valueAsNumber:S,valueAsDate:T}=e.target;switch(o){case"checkbox":return c;case"range":return S;case"date":return T;case"number":{if(r==="")return null;const p=Number.parseFloat(r);return+p-+p<1?+p:void 0}case"file":return y?l:l.item(0);case"select-multiple":return[...u].filter(p=>p.selected).map(p=>p.value);default:return r}},Se=(e,r,o)=>{const c=[...e];return[c[r],c[o]]=[c[o],c[r]],c},re=(e,r,o)=>{const c=[...e];return c.splice(r,0,o),c},K=(e,r,o)=>[o,r,e].filter(c=>!!c).map(c=>`${c.type?`error-${c.type}`:c}`).join(" "),W=e=>JSON.stringify(e,(r,o)=>o instanceof Set?[...o].sort():o),Y=new Map,we=(e,r)=>(Y.set(e,r),d.useEffect(()=>()=>Y.delete(e),[e]),d.useCallback((...o)=>Y.get(e)(...o),[e])),ve=({id:e,defaultValues:r,mode:o,classNameError:c,shouldFocusError:u=!1,resolver:l=h})=>{const[y,S]=d.useState({values:r||C,errors:{}}),{values:T,errors:p}=y,$=d.useRef(!1),I=d.useRef(!1),_=d.useRef(!1),N=d.useRef(new Map),j=d.useRef(),se=o==="onSubmit",ne=o==="onBlur",G=o==="onChange",te=!se&&!ne&&!G,[oe]=d.useState(()=>(s,t)=>S(n=>{const i=v(s,n.values,t);$.current=!0,I.current=j.current!==W(i);let a=n.errors;if((G||_.current&&te||R(s,a))&&(a=b(s,a),!se)){const f=E(s,l(i));f&&(a=v(s,a,f))}return{values:i,errors:a}})),[ke]=d.useState(()=>{const s=(n,i,a)=>{S(f=>{const m=v(n,f.values,i(E(n,f.values)));$.current=!0,I.current=j.current!==W(m);let g=f.errors;const x=E(n,g);let M=[];if(Array.isArray(x)&&(M=a(x)),G||_.current&&te){const F=E(n,l(m));if(F&&F.message){const X=M.length>0?M:{};X.message=F.message,X.type=F.type,M=X}}return g=b(n,g),(M.length>0||M.message)&&(g=v(n,g,M)),{values:m,errors:g}})},t=(n,i,a)=>{s(n,f=>re(f,i,a),f=>re(f,i,void 0))};return{insert:t,append:(n,i)=>t(n,U(n).length,i),prepend:(n,i)=>t(n,0,i),clear:n=>{const i=()=>[];s(n,i,i)},remove:(n,i)=>{const a=f=>[...f].filter((m,g)=>g!==i);s(n,a,a)},swap:(n,i,a)=>{const f=m=>Se(m,i,a);s(n,f,f)}}}),[D]=d.useState(()=>s=>S(t=>({...t,errors:s}))),[Re]=d.useState(()=>s=>{_.current=!0,D(s)}),[L]=d.useState(()=>s=>{const t=s||C;j.current=W(t),S(n=>({...n,values:{...t}}))}),[Q]=d.useState(()=>s=>{const t=N.current.get(s);return t&&t.focus?(t.focus(),!0):!1}),[ce]=d.useState(()=>(s="")=>new Promise((t=h)=>{S(n=>{let i=l(n.values);if(s!==""){const f=Array.isArray(s)?s:[s];let m={...n.errors};f.forEach(g=>{const x=E(g,i);m=b(g,m),x!==void 0&&(m=v(g,m,x))}),i=m}const a={...n,errors:i};return t(a),a})})),[ie]=d.useState(()=>(s,t)=>{let n=t;return R(s,t)&&(n=b(s,t)),n}),[Me]=d.useState(()=>s=>S(t=>{const n=t.errors,i=ie(s,n);return i===n?t:{...t,errors:i}})),[Oe]=d.useState(()=>s=>N.current.get(s)),[ue]=d.useState(()=>(s,t)=>{t&&N.current.set(s,t)}),[Te]=d.useState(()=>s=>s&&ue(s.name,s)),[_e]=d.useState(()=>(s,t=!0)=>{L(s||r),$.current=!1,I.current=!1,t&&ce("",s)}),[ae]=d.useState(()=>s=>oe(s.target.name,Ee(s)));let xe=1;const k=s=>we(`${e}!${xe++}`,s);d.useEffect(()=>(L(r),()=>{me()}),[r,L]);const U=k((s="")=>(N.current.has(s)||N.current.set(s,null),E(s,T))),V=k((s="",t=p)=>E(s,t)),R=k((s="",t=p)=>s===""?!H(t):E(s,t)!==void 0),fe=k(s=>{const{name:t}=s.target,n=E(t,l(T));n?(D(v(t,p,n)),u&&Q(t)):D(ie(t,p))}),Ce=k((s,t="")=>{const n=U(s),i=V(s),a=n===!0||n===!1;return{name:s,"aria-invalid":!!i,className:K(i,i?c:"",t),onChange:ae,onBlur:ne?fe:void 0,ref:Te,value:a?void 0:`${n}`=="0"?n:n||"",checked:a?n:void 0}}),Be=s=>t=>{t&&t.preventDefault();const n=l(T);if(D(n),R("",n)){if(u){let i=!1;N.current.forEach((a,f)=>{!i&&R(f,n)&&(i=Q(f))})}return _.current=!0,!1}return s(T),!0},be=k(({for:s,children:t})=>{const n=V(s,p);return n!=null&&n.message?Z(t)?t(n):A.jsx("span",{className:K(n,c),children:n.message}):!1}),de=!R(),$e=k(({children:s,focusable:t=!1})=>{if(de)return!1;const i=Array.from(N.current).map(a=>a[0]).filter(a=>a!=="").filter(a=>R(a,p)).sort().map(a=>{const f=V(a);return A.jsx("li",{className:K(f,c),children:t?A.jsx("a",{onClick:()=>Q(a),children:f.message}):f.message},a)});return Z(s)?s(i):i});return{getValue:U,setValue:oe,register:Ce,onChange:ae,onBlur:fe,getRef:Oe,setRef:ue,trigger:ce,handleSubmit:Be,hasError:R,getError:V,clearError:Me,setErrors:Re,array:ke,key:pe,Error:be,Errors:$e,formState:{errors:p,isValid:de,isTouched:$.current,isDirty:I.current,hadError:_.current,reset:_e}}},Ae=e=>r=>{let o={};try{e.validateSync(r,{abortEarly:!1})}catch(c){for(const u of c.inner){const l=E(u.path,o)||{};l.message=u.message,l.type=u.type,o=v(u.path,o,l)}}return o},Ne=e=>r=>{let o={};const c=e.safeParse(r);return c.success||c.error.errors.forEach(u=>{const l=u.path.join("."),y=E(l,o)||{};y.message=u.message,y.type=u.type,o=v(l,o,y)}),o};w.default=ve,w.yupResolver=Ae,w.zodResolver=Ne,Object.defineProperties(w,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
